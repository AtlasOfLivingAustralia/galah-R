<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Object-Oriented Programming • galah</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Object-Oriented Programming">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">galah</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/quick_start_guide.html">Quick start guide</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Further information</h6></li>
    <li><a class="dropdown-item" href="../articles/look_up_information.html">Looking up information</a></li>
    <li><a class="dropdown-item" href="../articles/accessing_sensitive_data.html">Accessing sensitive data</a></li>
    <li><a class="dropdown-item" href="../articles/download-data-reproducibly.html">Reproduciblility</a></li>
    <li><a class="dropdown-item" href="../articles/object-oriented-programming.html">Object oriented programming</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Filtering</h6></li>
    <li><a class="dropdown-item" href="../articles/taxonomic_filtering.html">Taxonomic filtering</a></li>
    <li><a class="dropdown-item" href="../articles/spatial_filtering.html">Spatial filtering</a></li>
    <li><a class="dropdown-item" href="../articles/temporal_filtering.html">Temporal filtering</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AtlasOfLivingAustralia/galah-R/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Object-Oriented Programming</h1>
                        <h4 data-toc-skip class="author">Martin Westgate
&amp; Dax Kellie</h4>
            
            <h4 data-toc-skip class="date">2026-02-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/AtlasOfLivingAustralia/galah-R/blob/v2.2.0/vignettes/object-oriented-programming.Rmd" class="external-link"><code>vignettes/object-oriented-programming.Rmd</code></a></small>
      <div class="d-none name"><code>object-oriented-programming.Rmd</code></div>
    </div>

    
    
<p><code>galah</code> has some alot of functions that display
object-oriented behaviour, which are used for two purposes:</p>
<ul>
<li>building piped queries via <code>request</code> objects</li>
<li>handling the parsing of those objects into <code>query</code>
objects</li>
</ul>
<p>Below we’ll go through each in turn.</p>
<div class="section level2">
<h2 id="request-objects">
<code>request</code> objects<a class="anchor" aria-label="anchor" href="#request-objects"></a>
</h2>
<p>The default method for building queries in <code>galah</code> is to
first use <code><a href="../reference/galah_call.html">galah_call()</a></code> to create a query object called a
“<code>data_request</code>”. When a piped object is of class
<code>data_request</code>, galah triggers functions to use specific
methods for this object class, e.g.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op">==</span> <span class="st">"Crinia"</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 16 × 2</span></span>
<span><span class="co">##    species                 count</span></span>
<span><span class="co">##    &lt;chr&gt;                   &lt;int&gt;</span></span>
<span><span class="co">##  1 Crinia signifera        42477</span></span>
<span><span class="co">##  2 Crinia parinsignifera    8363</span></span>
<span><span class="co">##  3 Crinia glauerti          3111</span></span>
<span><span class="co">##  4 Crinia georgiana         1509</span></span>
<span><span class="co">##  5 Crinia remota             717</span></span>
<span><span class="co">##  6 Crinia sloanei            682</span></span>
<span><span class="co">##  7 Crinia insignifera        530</span></span>
<span><span class="co">##  8 Crinia tinnula            316</span></span>
<span><span class="co">##  9 Crinia deserticola        254</span></span>
<span><span class="co">## 10 Crinia pseudinsignifera   222</span></span>
<span><span class="co">## 11 Crinia tasmaniensis       182</span></span>
<span><span class="co">## 12 Crinia bilingua            75</span></span>
<span><span class="co">## 13 Crinia subinsignifera      46</span></span>
<span><span class="co">## 14 Crinia riparia             10</span></span>
<span><span class="co">## 15 Crinia flindersensis        3</span></span>
<span><span class="co">## 16 Crinia nimba                1</span></span></code></pre>
<p>Thanks to object-oriented programming, galah “masks”
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code> functions to use
methods defined for <code>data_request</code> objects instead. The full
list of masked functions is:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>)</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>)</li>
<li>
<code><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>)</li>
<li>
<code><a href="https://rdrr.io/r/graphics/identify.html" class="external-link">identify()</a></code> (<code>{graphics}</code>)</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>)</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>)</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>)</li>
<li>
<code><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop()</a></code> (<a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>)</li>
</ul>
<p>Note that these functions are all evaluated lazily; they amend the
underlying object, but do not amend the nature of the data until the
call is evaluated.</p>
</div>
<div class="section level2">
<h2 id="query-objects">
<code>query</code> objects<a class="anchor" aria-label="anchor" href="#query-objects"></a>
</h2>
<p>A <code>request</code> object stores all the information needed to
generate a query, but does not build or enact that query. To achieve
this, galah has a second object-oriented workflow, consisting of the
following stages</p>
<ul>
<li>
<code><a href="../reference/capture.data_request.html">capture()</a></code> identifies the url needed to execute the
request. For complex requests that require multiple API calls to
evaluate, it returns a <code>prequery</code> object. For simpler
requests it returns a <code>query</code>.</li>
<li>
<code>compund()</code> identifies the full set of queries necessary
to properly evaluate the specified request, returning them as a
<code>query_set</code>.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code> converts a <code>query_set</code> to a
<code>query</code>. This is the point in the pipeline where the final
url is generated.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> is intended to send the query in question to
the requested API for processing. This is particularly important for
occurrences, where it can be useful to submit a query and retrieve it at
a later time. If the <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> stage is not required,
however, <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> simply converts the <code>query</code>
to a new class (<code>computed_query</code>).</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> retrieves the requested data into your
workspace, returning a <code>tibble</code>.</li>
</ul>
<p>We can use these in sequence, or just leap ahead to the stage we
want:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galah_call.html">request_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op">==</span> <span class="st">"Crinia"</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/capture.data_request.html">capture</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class prequery with type data/occurrences-count-groupby</span></span></code></pre>
<pre><code><span><span class="co">## • url: https://api.ala.org.au/occurrences/occurrences/facets?fq=%28genus%3A%2...</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compound.html">compound</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class query_set containing 3 queries:</span></span></code></pre>
<pre><code><span><span class="co">## • metadata/fields data: galah:::retrieve_cache("fields")</span></span></code></pre>
<pre><code><span><span class="co">## • metadata/assertions data: galah:::retrieve_cache("assertions")</span></span></code></pre>
<pre><code><span><span class="co">## • data/occurrences-count-groupby url: https://api.ala.org.au/occurrences/occurr...</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class query with type data/occurrences-count-groupby</span></span></code></pre>
<pre><code><span><span class="co">## • url: https://api.ala.org.au/occurrences/occurrences/facets?fq=%28genus%3A%2...</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 6 × 2</span></span>
<span><span class="co">##   species              count</span></span>
<span><span class="co">##   &lt;chr&gt;                &lt;int&gt;</span></span>
<span><span class="co">## 1 Crinia bilingua         75</span></span>
<span><span class="co">## 2 Crinia deserticola     254</span></span>
<span><span class="co">## 3 Crinia flindersensis     3</span></span>
<span><span class="co">## 4 Crinia georgiana      1509</span></span>
<span><span class="co">## 5 Crinia glauerti       3111</span></span>
<span><span class="co">## 6 Crinia insignifera     530</span></span></code></pre>
<p>The benefit of this workflow is that it is highly modular. This is
critical for debugging workflows that might have gone wrong for one
reason or another, but it is also useful for handling large data
requests in galah. Users can send their query using
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code>, and download data once the query has finished —
downloading with <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> later — rather than waiting for
the request to finish within R.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create and send query to be calculated server-side</span></span>
<span><span class="va">request</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galah_call.html">request_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/identify.html" class="external-link">identify</a></span><span class="op">(</span><span class="st">"perameles"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1900</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Download data</span></span>
<span><span class="va">request</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="metadata-requests">metadata requests<a class="anchor" aria-label="anchor" href="#metadata-requests"></a>
</h2>
<p>For the above workflow to be achivable, it is neccessary for every
API call in <code>galah</code> to be written as a <code>request</code>
object. This is because <code><a href="../reference/compound.html">compound()</a></code> must collect a range of
different requests to evaluate a single query. To this end,
<code>galah</code> supports metadata requests, in addition to the data
requests described above.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">request_metadata</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"fields"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Or to show values for states and territories:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">request_metadata</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">field</span> <span class="op">==</span> <span class="st">"cl22"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/unnest.html">unnest</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>While <code><a href="../reference/galah_call.html">request_metadata()</a></code> is more modular than
<code><a href="../reference/show_all.html">show_all()</a></code>, there is little benefit to using it for most
applications. However, in some cases, larger databases like GBIF return
huge <code>data.frame</code>s of metadata when called via
<code><a href="../reference/show_all.html">show_all()</a></code>. Using <code>request_metdata()</code> allows
users to specify a <code><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head()</a></code> line within their pipe to
get around this issue.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Westgate, Dax Kellie.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
