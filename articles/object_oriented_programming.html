<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="galah">
<title>Object-Oriented Programming in galah • galah</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Code_Pro-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Object-Oriented Programming in galah">
<meta property="og:description" content="galah">
<meta property="og:image" content="https://galah.ala.org.au/R/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">galah</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/quick_start_guide.html">Quick start guide</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Get started</h6>
    <a class="dropdown-item" href="../articles/choosing_an_atlas.html">Choosing an atlas</a>
    <a class="dropdown-item" href="../articles/look_up_information.html">Look up information</a>
    <a class="dropdown-item" href="../articles/narrow_your_results.html">Narrow your results</a>
    <a class="dropdown-item" href="../articles/download_data.html">Download data</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced</h6>
    <a class="dropdown-item" href="../articles/object_oriented_programming.html">Object-oriented programming</a>
    <a class="dropdown-item" href="../articles/taxonomic_filtering.html">Taxonomic filtering</a>
    <a class="dropdown-item" href="../articles/spatial_filtering.html">Spatial filtering</a>
    <a class="dropdown-item" href="../articles/temporal_filtering.html">Temporal filtering</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/AtlasOfLivingAustralia/galah-R/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Object-Oriented Programming in galah</h1>
                        <h4 data-toc-skip class="author">Martin
Westgate, Dax Kellie</h4>
            
            <h4 data-toc-skip class="date">2023-12-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/AtlasOfLivingAustralia/galah-R/blob/HEAD/vignettes/object_oriented_programming.Rmd" class="external-link"><code>vignettes/object_oriented_programming.Rmd</code></a></small>
      <div class="d-none name"><code>object_oriented_programming.Rmd</code></div>
    </div>

    
    
<p>From version 2.0 onwards, galah is built around object-oriented
programming principles. In practice, this won’t change the experience
for most users. However, it does enable new ways of programming that
were not previously available.</p>
<div class="section level2">
<h2 id="masked-functions">Masked functions<a class="anchor" aria-label="anchor" href="#masked-functions"></a>
</h2>
<p>The default method for building queries in galah is to first use
<code><a href="../reference/galah_call.html">galah_call()</a></code> to create a query object called a
<code>data_request</code>. This object class is specific to galah.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/galah_filter.html">galah_filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op">==</span> <span class="st">"Crinia"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "data_request"</span></span></code></pre>
<p>When an object is of class <code>data_request</code>, galah can
trigger functions to use specific methods for this object class, even if
a function name is used by another package. For example, users can use
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code> functions from <a href="https://dplyr.tidyverse.org/index.html" class="external-link">dplyr</a> instead of
<code><a href="../reference/galah_filter.html">galah_filter()</a></code> and <code><a href="../reference/galah_group_by.html">galah_group_by()</a></code> to
construct a query. Consequently, the following queries are
synonymous:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/galah_filter.html">galah_filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op">==</span> <span class="st">"Crinia"</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/galah_group_by.html">galah_group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/atlas_counts.html">atlas_counts</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op">==</span> <span class="st">"Crinia"</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/atlas_counts.html">atlas_counts</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 16 × 2</span></span>
<span><span class="co">##    species                 count</span></span>
<span><span class="co">##    &lt;chr&gt;                   &lt;int&gt;</span></span>
<span><span class="co">##  1 Crinia signifera        58204</span></span>
<span><span class="co">##  2 Crinia parinsignifera   12478</span></span>
<span><span class="co">##  3 Crinia glauerti          3090</span></span>
<span><span class="co">##  4 Crinia georgiana         1490</span></span>
<span><span class="co">##  5 Crinia remota             784</span></span>
<span><span class="co">##  6 Crinia sloanei            644</span></span>
<span><span class="co">##  7 Crinia insignifera        536</span></span>
<span><span class="co">##  8 Crinia tinnula            417</span></span>
<span><span class="co">##  9 Crinia deserticola        278</span></span>
<span><span class="co">## 10 Crinia pseudinsignifera   236</span></span>
<span><span class="co">## 11 Crinia tasmaniensis       189</span></span>
<span><span class="co">## 12 Crinia bilingua            75</span></span>
<span><span class="co">## 13 Crinia subinsignifera      45</span></span>
<span><span class="co">## 14 Crinia riparia             10</span></span>
<span><span class="co">## 15 Crinia flindersensis        3</span></span>
<span><span class="co">## 16 Crinia nimba                1</span></span></code></pre>
<p>Thanks to object-oriented programming, galah “masks”
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code> functions to use
methods defined for <code>data_request</code> objects instead. The full
list of masked functions is:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>)</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>)</li>
<li>
<code><a href="https://rdrr.io/r/graphics/identify.html" class="external-link">identify()</a></code> (<code>{graphics}</code>) as a synonym for
<code><a href="../reference/galah_identify.html">galah_identify()</a></code>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>) as a synonym for
<code><a href="../reference/galah_select.html">galah_select()</a></code>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>) as a synonym for
<code><a href="../reference/galah_group_by.html">galah_group_by()</a></code>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>) as a synonym for
the <code>limit</code> argument in <code><a href="../reference/atlas_counts.html">atlas_counts()</a></code>
</li>
<li>
<code><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop()</a></code> (<a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>) as a synonym for
<code><a href="../reference/galah_geolocate.html">galah_polygon()</a></code>
</li>
</ul>
<p>Note that these functions are all evaluated lazily; they amend the
underlying object, but do not amend the nature of the data until the
call is evaluated. To actually build and run the query, we’ll need to
use one or more of a different set of dplyr verbs:
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> and
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="advanced-query-building">Advanced query building<a class="anchor" aria-label="anchor" href="#advanced-query-building"></a>
</h2>
<p>The usual way to begin a query to request data in galah is using
<code><a href="../reference/galah_call.html">galah_call()</a></code>. From version 2.0, to make galah more flexible
and modular, the underlying architecture of <code><a href="../reference/galah_call.html">galah_call()</a></code>
has been divided into several types of <code>request_</code> functions.
You can begin your pipe with one of these dedicated
<code>request_</code> functions (rather than <code><a href="../reference/galah_call.html">galah_call()</a></code>)
depending on the type of data you want to collect.</p>
<p>For example, if you want to download occurrences, use
<code><a href="../reference/galah_call.html">request_data()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galah_call.html">request_data</a></span><span class="op">(</span><span class="st">"occurrences"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># note that "occurrences" is the default `type`</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Crinia tinnula"</span>, </span>
<span>         <span class="va">year</span> <span class="op">==</span> <span class="fl">2010</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>You’ll notice that this query differs slightly from the typical query
structure users of galah are familiar with. The desired data type,
<code>"occurrences"</code>, is specified at the beginning of the query
within <code><a href="../reference/galah_call.html">request_data()</a></code> rather than at the end using
<code><a href="../reference/atlas_occurrences.html">atlas_occurrences()</a></code>. Specifying the data type at the start
allows users to make use of advanced query building using three newly
implemented stages of query building: <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code>,
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code>. These stages mirror
existing <a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">functions in
dplyr for querying databases</a>, and act in the following way</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code> converts the object to a query. This allows
users to inspect their<br>
API calls before they are sent</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> sends queries to any required APIs. This
includes sending a query for data, determining whether field names are
valid, or finding how much data has been requested (which is necessary
for pagination)</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> retrieves the requested data into your
workspace</li>
</ul>
<p>We can use these in sequence, or just leap ahead to the stage we
want:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galah_call.html">request_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op">==</span> <span class="st">"Crinia"</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class `query_set` containing 3 queries:</span></span></code></pre>
<pre><code><span><span class="co">## • metadata/fields data: galah:::check_internal_cache()$fields</span></span>
<span><span class="co">## • metadata/assertions data: galah:::check_internal_cache()$assertions</span></span>
<span><span class="co">## • data/occurrences-count-groupby url: https://biocache-ws.ala.org.au/ws/occurre...</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class query with type data/occurrences-count-groupby </span></span>
<span><span class="co">## url: https://biocache-ws.ala.org.au/ws/occurrences/facets?fq=%28genus%3A%22... </span></span>
<span><span class="co">## arrange: species (ascending)</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 6 × 2</span></span>
<span><span class="co">##   species              count</span></span>
<span><span class="co">##   &lt;chr&gt;                &lt;int&gt;</span></span>
<span><span class="co">## 1 Crinia bilingua         75</span></span>
<span><span class="co">## 2 Crinia deserticola     278</span></span>
<span><span class="co">## 3 Crinia flindersensis     3</span></span>
<span><span class="co">## 4 Crinia georgiana      1490</span></span>
<span><span class="co">## 5 Crinia glauerti       3090</span></span>
<span><span class="co">## 6 Crinia insignifera     536</span></span></code></pre>
<p>The benefit of using <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code>
and <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> is that queries are more modular. This is
particularly useful for large data requests in galah. Users can send
their query using <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code>, and download data once the
query has finished — downloading with <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> later —
rather than waiting for the request to finish within R.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create and send query to be calculated server-side</span></span>
<span><span class="va">request</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galah_call.html">request_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/identify.html" class="external-link">identify</a></span><span class="op">(</span><span class="st">"perameles"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1900</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Download data</span></span>
<span><span class="va">request</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Additionally, functions that are more modular are generally easier to
interrogate and debug. Previously some functions did several different
things, making it difficult to know which APIs were being called, when,
and for what purpose. Partitioning queries into three distinct stages is
much more transparent, and allows users to check their query
construction prior to sending a request. For example, the query above is
constructed with the following information, returned by
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">request_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/identify.html" class="external-link">identify</a></span><span class="op">(</span><span class="st">"perameles"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1900</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class `query_set` containing 5 queries:</span></span></code></pre>
<pre><code><span><span class="co">## • metadata/fields data: galah:::check_internal_cache()$fields</span></span>
<span><span class="co">## • metadata/assertions data: galah:::check_internal_cache()$assertions</span></span>
<span><span class="co">## • metadata/reasons data: galah:::check_internal_cache()$reasons</span></span>
<span><span class="co">## • metadata/taxa-single url: https://api.ala.org.au/namematching/api/search?q=pe...</span></span>
<span><span class="co">## • data/occurrences url: https://biocache-ws.ala.org.au/ws/occurrences/offline/d...</span></span></code></pre>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code> stage displays useful information about
which APIs will be pinged by a query in galah when it is sent using
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="new-object-classes">New object classes<a class="anchor" aria-label="anchor" href="#new-object-classes"></a>
</h2>
<p>Under the hood, the different query-building verbs amend our object
to a new class:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code> returns class <code>query_set</code>, which
is a list of one or more <code>query</code> objects</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> returns a single object of class
<code>query</code>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> doesn’t add a new data class (returns class
<code>tibble</code>)</li>
</ul>
<p>These can be called directly, or via the <code>method</code> and
<code>type</code> arguments of <code><a href="../reference/galah_call.html">galah_call()</a></code>, which specify
which dedicated <code>request_</code> function and data type to return.
To demonstrate what we mean, take the following calls, which despite
using different syntax, all return the number of records available for
the year 2020:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># new syntax</span></span>
<span><span class="fu"><a href="../reference/galah_call.html">request_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># similar, but using `galah_call()`</span></span>
<span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>           type <span class="op">=</span> <span class="st">"occurrences-count"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># original syntax</span></span>
<span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/galah_filter.html">galah_filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/atlas_counts.html">atlas_counts</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Another example is to list available <code>fields</code> in the
selected atlas:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">request_metadata</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"fields"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"metadata"</span>, </span>
<span>           type <span class="op">=</span> <span class="st">"fields"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/show_all.html">show_all</a></span><span class="op">(</span><span class="va">fields</span><span class="op">)</span></span></code></pre></div>
<p>Or to show values for states and territories:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">request_metadata</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">field</span> <span class="op">==</span> <span class="st">"cl22"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/tidyverse_functions.html">unnest</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"metadata"</span>, </span>
<span>           type <span class="op">=</span> <span class="st">"fields-unnest"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/galah_filter.html">galah_filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"cl22"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/search_all.html">search_all</a></span><span class="op">(</span><span class="va">fields</span>, <span class="st">"cl22"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/show_values.html">show_values</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Although there is little reason to use
<code><a href="../reference/galah_call.html">request_metadata()</a></code> rather than <code><a href="../reference/show_all.html">show_all()</a></code> most
of the time, in some cases larger databases like GBIF return huge
<code>data.frame</code>s of metadata. galah allows users to use
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> and
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> on all types of requests, meaning users are able
to download large metadata queries using the process detailed above in
“Advanced query building” to get around this issue.</p>
</div>
<div class="section level2">
<h2 id="do-i-need-to-use-advanced-query-building">Do I need to use advanced query building?<a class="anchor" aria-label="anchor" href="#do-i-need-to-use-advanced-query-building"></a>
</h2>
<p>Despite these benefits, we have no plans to <em>require</em> this new
syntax; functions prefixed with <code>galah_</code> or
<code>atlas_</code> are not going away.</p>
<p>Indeed, while there is perfect redundancy between old and new syntax
in some cases, in others they serve different purposes. In
<code><a href="../reference/atlas_media.html">atlas_media()</a></code> for example, several calls are made and
joined in a way that reduces the number of steps required by the
user.</p>
<p>Under the hood, however, all <code>atlas_</code> functions are now
entirely built using the above syntax.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Martin Westgate, Matilda Stevenson, Dax Kellie, Peggy Newman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
