<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Object-Oriented Programming • galah</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Object-Oriented Programming">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">galah</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/quick_start_guide.html">Quick start guide</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Get started</h6></li>
    <li><a class="dropdown-item" href="../articles/choosing_an_atlas.html">Choosing an atlas</a></li>
    <li><a class="dropdown-item" href="../articles/look_up_information.html">Look up information</a></li>
    <li><a class="dropdown-item" href="../articles/narrow_your_results.html">Narrow your results</a></li>
    <li><a class="dropdown-item" href="../articles/download_data.html">Download data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/object_oriented_programming.html">Object-oriented programming</a></li>
    <li><a class="dropdown-item" href="../articles/download-data-reproducibly.html">Reproduciblility</a></li>
    <li><a class="dropdown-item" href="../articles/taxonomic_filtering.html">Taxonomic filtering</a></li>
    <li><a class="dropdown-item" href="../articles/spatial_filtering.html">Spatial filtering</a></li>
    <li><a class="dropdown-item" href="../articles/temporal_filtering.html">Temporal filtering</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AtlasOfLivingAustralia/galah-R/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Object-Oriented Programming</h1>
                        <h4 data-toc-skip class="author">Martin Westgate
&amp; Dax Kellie</h4>
            
            <h4 data-toc-skip class="date">2024-11-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/AtlasOfLivingAustralia/galah-R/blob/main/vignettes/object_oriented_programming.Rmd" class="external-link"><code>vignettes/object_oriented_programming.Rmd</code></a></small>
      <div class="d-none name"><code>object_oriented_programming.Rmd</code></div>
    </div>

    
    
<p>The default method for building queries in <code>galah</code> is to
first use <code><a href="../reference/galah_call.html">galah_call()</a></code> to create a query object called a
“<code>data_request</code>”. This object class is specific to
<code>galah</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op">==</span> <span class="st">"Crinia"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "data_request"</span></span></code></pre>
<p>When a piped object is of class <code>data_request</code>, galah can
trigger functions to use specific methods for this object class, even if
a function name is used by another package. For example, users can use
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code> functions from <a href="https://dplyr.tidyverse.org/index.html" class="external-link">dplyr</a> instead of
<code><a href="../reference/filter.data_request.html">galah_filter()</a></code> and <code><a href="../reference/group_by.data_request.html">galah_group_by()</a></code> to
construct a query. Consequently, the following queries are
synonymous:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter.data_request.html">galah_filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op">==</span> <span class="st">"Crinia"</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/group_by.data_request.html">galah_group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/atlas_.html">atlas_counts</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op">==</span> <span class="st">"Crinia"</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/atlas_.html">atlas_counts</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 16 × 2</span></span>
<span><span class="co">##    species                 count</span></span>
<span><span class="co">##    &lt;chr&gt;                   &lt;int&gt;</span></span>
<span><span class="co">##  1 Crinia signifera        42621</span></span>
<span><span class="co">##  2 Crinia parinsignifera    8664</span></span>
<span><span class="co">##  3 Crinia glauerti          3111</span></span>
<span><span class="co">##  4 Crinia georgiana         1509</span></span>
<span><span class="co">##  5 Crinia remota             718</span></span>
<span><span class="co">##  6 Crinia sloanei            682</span></span>
<span><span class="co">##  7 Crinia insignifera        530</span></span>
<span><span class="co">##  8 Crinia tinnula            291</span></span>
<span><span class="co">##  9 Crinia deserticola        253</span></span>
<span><span class="co">## 10 Crinia pseudinsignifera   223</span></span>
<span><span class="co">## 11 Crinia tasmaniensis       181</span></span>
<span><span class="co">## 12 Crinia bilingua            74</span></span>
<span><span class="co">## 13 Crinia subinsignifera      46</span></span>
<span><span class="co">## 14 Crinia riparia             10</span></span>
<span><span class="co">## 15 Crinia flindersensis        3</span></span>
<span><span class="co">## 16 Crinia nimba                1</span></span></code></pre>
<p>Thanks to object-oriented programming, galah “masks”
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code> functions to use
methods defined for <code>data_request</code> objects instead. The full
list of masked functions is:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>)</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>)</li>
<li>
<code><a href="https://rdrr.io/r/graphics/identify.html" class="external-link">identify()</a></code> (<code>{graphics}</code>) as a synonym for
<code><a href="../reference/identify.data_request.html">galah_identify()</a></code>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>) as a synonym for
<code><a href="../reference/select.data_request.html">galah_select()</a></code>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>) as a synonym for
<code><a href="../reference/group_by.data_request.html">galah_group_by()</a></code>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head()</a></code> (<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>) as a synonym for
the <code>limit</code> argument in <code><a href="../reference/atlas_.html">atlas_counts()</a></code>
</li>
<li>
<code><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop()</a></code> (<a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>) as a synonym for
<code><a href="../reference/geolocate.html">galah_polygon()</a></code>
</li>
</ul>
<p>Note that these functions are all evaluated lazily; they amend the
underlying object, but do not amend the nature of the data until the
call is evaluated. To actually build and run the query, we’ll need to
use one or more of a different set of dplyr verbs:
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> and
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code>.</p>
<div class="section level2">
<h2 id="advanced-query-building">Advanced query building<a class="anchor" aria-label="anchor" href="#advanced-query-building"></a>
</h2>
<p>The usual way to begin a query to request data in galah is using
<code><a href="../reference/galah_call.html">galah_call()</a></code>. However, this function now calls one of three
types of <code>request_</code> functions. If you prefer, you can begin
your pipe with one of these dedicated <code>request_</code> functions
(rather than <code><a href="../reference/galah_call.html">galah_call()</a></code>) depending on the type of data
you want to collect.</p>
<p>For example, if you want to download occurrences, use
<code><a href="../reference/galah_call.html">request_data()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galah_call.html">request_data</a></span><span class="op">(</span><span class="st">"occurrences"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># note that "occurrences" is the default `type`</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Crinia tinnula"</span>, </span>
<span>         <span class="va">year</span> <span class="op">==</span> <span class="fl">2010</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>You’ll notice that this query differs slightly from the query
structure used in earlier versions of <code>galah</code>. The desired
data type, <code>"occurrences"</code>, is specified at the beginning of
the query within <code><a href="../reference/galah_call.html">request_data()</a></code> rather than at the end
using <code><a href="../reference/atlas_.html">atlas_occurrences()</a></code>. Specifying the data type at the
start allows users to make use of advanced query building using three
newly implemented stages of query building: <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code>,
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code>. These stages mirror
existing <a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">functions in
dplyr for querying databases</a>, and act in the following way:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code> converts the object to a <code>query</code>.
This allows users to inspect<br>
their API calls before they are sent. Depending on the request, this
function may also call ‘supplementary’ APIs to collect required
information, such as Taxon Concept Identifiers or field names.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> is intended to send the query in question to
the requested API for processing. This is particularly important for
occurrences, where it can be useful to submit a query and retrieve it at
a later time. If the <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> stage is not required,
however, <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> simply converts the <code>query</code>
to a new class (<code>computed_query</code>).</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> retrieves the requested data into your
workspace, returning a <code>tibble</code>.</li>
</ul>
<p>We can use these in sequence, or just leap ahead to the stage we
want:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galah_call.html">request_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op">==</span> <span class="st">"Crinia"</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class query with type data/occurrences-count-groupby </span></span>
<span><span class="co">## url: https://api.ala.org.au/occurrences/occurrences/facets?fq=%28genus%3A%2... </span></span>
<span><span class="co">## arrange: species (ascending)</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class computed_query with type data/occurrences-count-groupby </span></span>
<span><span class="co">## url: https://api.ala.org.au/occurrences/occurrences/facets?fq=%28genus%3A%2... </span></span>
<span><span class="co">## arrange: species (ascending)</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 6 × 2</span></span>
<span><span class="co">##   species              count</span></span>
<span><span class="co">##   &lt;chr&gt;                &lt;int&gt;</span></span>
<span><span class="co">## 1 Crinia bilingua         74</span></span>
<span><span class="co">## 2 Crinia deserticola     253</span></span>
<span><span class="co">## 3 Crinia flindersensis     3</span></span>
<span><span class="co">## 4 Crinia georgiana      1509</span></span>
<span><span class="co">## 5 Crinia glauerti       3111</span></span>
<span><span class="co">## 6 Crinia insignifera     530</span></span></code></pre>
<p>The benefit of using <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code>
and <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> is that queries are more modular. This is
particularly useful for large data requests in galah. Users can send
their query using <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code>, and download data once the
query has finished — downloading with <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> later —
rather than waiting for the request to finish within R.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create and send query to be calculated server-side</span></span>
<span><span class="va">request</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galah_call.html">request_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/identify.html" class="external-link">identify</a></span><span class="op">(</span><span class="st">"perameles"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1900</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Download data</span></span>
<span><span class="va">request</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Additionally, functions that are more modular are generally easier to
interrogate and debug. Previously some functions did several different
things, making it difficult to know which APIs were being called, when,
and for what purpose. Partitioning queries into three distinct stages is
much more transparent, and allows users to check their query
construction prior to sending a request. For example, the query above is
constructed with the following information, returned by
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">request_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/identify.html" class="external-link">identify</a></span><span class="op">(</span><span class="st">"perameles"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1900</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class query with type data/occurrences </span></span>
<span><span class="co">## url: https://api.ala.org.au/occurrences/occurrences/offline/download?fq=%28...</span></span></code></pre>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code> stage includes an additional argument
(<code>.expand</code>) that, when set to <code>TRUE</code>, shows all
the APIs called to construct the user-requested query. This is
especially useful for debugging.</p>
</div>
<div class="section level2">
<h2 id="object-classes">Object classes<a class="anchor" aria-label="anchor" href="#object-classes"></a>
</h2>
<p>Under the hood, the different query-building verbs each amend the
supplied object to a new class:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collapse()</a></code> returns class <code>query</code>, which is a
list containing a <code>type</code> slot and one or more
<code>url</code>s</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> returns a single object of class
<code>computed_query</code>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> returns a <code>tibble</code>
</li>
</ul>
<p>These can be called directly, or via the <code>method</code> and
<code>type</code> arguments of <code><a href="../reference/galah_call.html">galah_call()</a></code>, which specify
which dedicated <code>request_</code> function and data type to return.
To demonstrate what we mean, take the following calls, which despite
using different syntax, all return the number of records available for
the year 2020:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># new syntax</span></span>
<span><span class="fu"><a href="../reference/galah_call.html">request_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># similar, but using `galah_call()`</span></span>
<span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>           type <span class="op">=</span> <span class="st">"occurrences-count"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># original syntax</span></span>
<span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter.data_request.html">galah_filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/atlas_.html">atlas_counts</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Another example is to list available <code>fields</code> in the
selected atlas:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">request_metadata</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"fields"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"metadata"</span>, </span>
<span>           type <span class="op">=</span> <span class="st">"fields"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/show_all.html">show_all</a></span><span class="op">(</span><span class="va">fields</span><span class="op">)</span></span></code></pre></div>
<p>Or to show values for states and territories:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/galah_call.html">request_metadata</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">field</span> <span class="op">==</span> <span class="st">"cl22"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/tidyverse_functions.html">unnest</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/galah_call.html">galah_call</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"metadata"</span>, </span>
<span>           type <span class="op">=</span> <span class="st">"fields-unnest"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter.data_request.html">galah_filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"cl22"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/search_all.html">search_all</a></span><span class="op">(</span><span class="va">fields</span>, <span class="st">"cl22"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/show_values.html">show_values</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>While <code><a href="../reference/galah_call.html">request_metadata()</a></code> is more modular than
<code><a href="../reference/show_all.html">show_all()</a></code>, there is little benefit to using it for most
applications. However, in some cases, larger databases like GBIF return
huge <code>data.frame</code>s of metadata when called via
<code><a href="../reference/show_all.html">show_all()</a></code>. Using <code>request_metdata()</code> allows
users to specify a <code><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head()</a></code> line within their pipe to
get around this issue.</p>
</div>
<div class="section level2">
<h2 id="which-syntax-should-i-prefer">Which syntax should I prefer?<a class="anchor" aria-label="anchor" href="#which-syntax-should-i-prefer"></a>
</h2>
<p>Despite these benefits, we have no plans to <em>require</em> users to
call masked functions. Functions prefixed with <code>galah_</code> or
<code>atlas_</code> are not going away. Indeed, while there is perfect
redundancy between old and new syntax in some cases, in others they
serve different purposes. In <code><a href="../reference/atlas_.html">atlas_media()</a></code> for example,
several calls are made and joined in a way that reduces the number of
steps required by the user. Under the hood, however, all
<code>atlas_</code> functions are now entirely built using the above
syntax.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Westgate, Dax Kellie, Matilda Stevenson, Peggy Newman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
