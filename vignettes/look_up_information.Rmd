---
title: "Look up information"
author: "Martin Westgate & Dax Kellie"
date: '2022-10-13'
output:
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Look up information}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# `show_all_` functions
Functions with the prefix `show_all_` return a `tibble` doing exactly that 
- showing all the possible values of the category specified. These functions include:

-   `show_all_fields`
-   `show_all_atlases`
-   `show_all_ranks`
-   `show_all_profiles`
-   `show_all_reasons`
-   `show_all_cached_files`

`show_all_` functions require no arguments. Simply call the function and it will 
return all accepted values as a tibble:


```r
show_all_atlases()
```

```
## # A tibble: 11 × 4
##    atlas          institution                                                             acronym url                         
##    <chr>          <chr>                                                                   <chr>   <chr>                       
##  1 Australia      Atlas of Living Australia                                               ALA     https://www.ala.org.au      
##  2 Austria        Biodiversitäts-Atlas Österreich                                         BAO     https://biodiversityatlas.at
##  3 Brazil         Sistemas de Informações sobre a Biodiversidade Brasileira               SiBBr   https://sibbr.gov.br        
##  4 Canada         Candensys                                                               <NA>    http://www.canadensys.net   
##  5 Estonia        eElurikkus                                                              <NA>    https://elurikkus.ee        
##  6 France         Inventaire National du Patrimoine Naturel                               INPN    https://inpn.mnhn.fr        
##  7 Guatemala      Sistema Nacional de Información sobre Diversidad Biológica de Guatemala SNIBgt  https://snib.conap.gob.gt   
##  8 Portugal       GBIF Portugal                                                           GBIF.pt https://www.gbif.pt         
##  9 Spain          GBIF Spain                                                              GBIF.es https://www.gbif.es         
## 10 Sweden         Swedish Biodiversity Data Infrastructure                                SBDI    https://biodiversitydata.se 
## 11 United Kingdom National Biodiversity Network                                           NBN     https://nbn.org.uk
```

```r
show_all_reasons()
```

```
## # A tibble: 8 × 2
##      id name                                                                                                                                                           
##   <int> <chr>                                                                                                                                                          
## 1     3 education|Download is for primary, secondary or tertiary educational purposes                                                                                  
## 2    10 testing|Testing                                                                                                                                                
## 3    13 statutory|Download is by a government-linked body or local authority for their statutory work                                                                  
## 4    14 LERC work|Download is for use by a local environmental records centre to support the provision of its services                                                 
## 5    15 public|Download is for personal use only                                                                                                                       
## 6    16 volunteer researcher/publisher|Download may lead to amateur (non-funded) publication, which could include National or Local scheme collators and verifiers     
## 7    17 professional researcher/publisher|Download may lead to professional publication (including universities, NGOs etc. where people are being paid to research and…
## 8    18 commercial|Download is for the purposes of fulfilling a commercial contract
```

Of these functions, the one that has by far the largest output is 
`show_all_fields()`. Fields are used to filter and narrow queries. The full 
list of fields is too long to display, but here is a slice of the 
results of `show_all_fields()`.


```r
show_all(fields) |>
  dplyr::slice(1:10) # Take slice of first 10 rows
```

```
## # A tibble: 10 × 3
##    id                    description                                                                                                                              type 
##    <chr>                 <chr>                                                                                                                                    <chr>
##  1 acceptedNameUsage     The full name, with authorship and date information if known, of the currently valid (zoological) or accepted (botanical) taxon.         fiel…
##  2 acceptedNameUsageID   An identifier for the name usage (documented meaning of the name according to a source) of the currently valid (zoological) or accepted… fiel…
##  3 accessRights          <NA>                                                                                                                                     fiel…
##  4 all_image_url         <NA>                                                                                                                                     fiel…
##  5 assertion_user_id     Assertions by user                                                                                                                       fiel…
##  6 assertions            Record issues                                                                                                                            fiel…
##  7 assertions_missing    <NA>                                                                                                                                     fiel…
##  8 assertions_passed     <NA>                                                                                                                                     fiel…
##  9 associatedMedia       A list (concatenated and separated) of identifiers (publication, global unique identifier, URI) of media associated with the Occurrence. fiel…
## 10 associatedOccurrences A list (concatenated and separated) of identifiers of other Occurrence records and their associations to this Occurrence.                fiel…
```

One way to browse all fields is to use `View()` or `dplyr::view()` to open the 
results in a new tab in R to scroll through.


```r
show_all_fields() |> View() # Open table in new tab
```

Given how important fields are to the proper use of `galah`, it might be more 
useful to search for a specific field. This need for a more detailed search is when
`search_` functions come in handy.


# `search_` functions
The second subset of lookup functions use the `search_` prefix, and differ from
`show_all_` in that they require a query to work. They are used to search for 
detailed information that can't be summarised across the whole atlas, and include:

-   `search_taxa`
-   `search_identifiers`
-   `search_fields`
-   `search_field_values`
-   `search_profile attributes`

Search for a single taxon or multiple taxa by name with `search_taxa`.


```r
search_taxa("reptilia")
```

```
## # A tibble: 1 × 9
##   search_term taxon_concept_id scientific_name scientific_name_authorship rank  kingdom  superclass phylum   class   
##   <chr>       <chr>            <chr>           <chr>                      <chr> <chr>    <chr>      <chr>    <chr>   
## 1 reptilia    NHMSYS0000375236 Reptilia        Laurenti, 1768             class Animalia Tetrapoda  Chordata Reptilia
```

```r
search_taxa("reptilia", "aves", "mammalia", "pisces")
```

```
## Error in (function (..., row.names = NULL, check.rows = FALSE, check.names = TRUE, : arguments imply differing number of rows: 1, 0
```

Alternatively, `search_identifiers` is the partner function to `search_taxa`. 
If we already know a taxonomic identifier, we can search for 
which taxa the identifier belongs to with `search_identifiers`:


```r
search_identifiers("urn:lsid:biodiversity.org.au:afd.taxon:682e1228-5b3c-45ff-833b-550efd40c399")
```

```
## Error in `FUN()`:
## ! `search_identifiers` only provides information on Australian taxonomy.
## ℹ To search for a species name, use `search_taxa()` instead.
```

Sifting through the output of `show_all_fields` to find a specific field can be 
inefficient. Instead, we might wish to use `search_fields` to look for specific 
fields that match a search. As with `search_taxa`, `search_fields` requires a 
query to work.


```r
search_fields("date") |> head()
```

```
## # A tibble: 6 × 3
##   id             description                                                                                                                                      type 
##   <chr>          <chr>                                                                                                                                            <chr>
## 1 eventDate      The date-time or interval during which an Event occurred. For occurrences, this is the date-time when the event was recorded. Not suitable for … fiel…
## 2 dateDeleted    <NA>                                                                                                                                             fiel…
## 3 modified_date  <NA>                                                                                                                                             fiel…
## 4 dateIdentified The date on which the subject was identified as representing the Taxon. Recommended best practice is to use an encoding scheme, such as ISO 860… fiel…
## 5 date_precision Date precision                                                                                                                                   fiel…
## 6 last_load_date <NA>                                                                                                                                             fiel…
```

# `show_values()` & `search_values()`

Once a desired field is found, use `search_field_values` to find values to pass 
to `galah_filter`.


```r
search_field_values("basisOfRecord")
```

```
## Warning: We didn't detect a valid query.
## ℹ Try entering text to search for matching values.
```

```
## Error in `search_field_values()`:
## ! Invalid field detected.
## ℹ Search for the valid name of a desired field with `search_fields()`.
## ✖ "basisOfRecord" is not a valid field.
```

```r
galah_call() |> 
  galah_filter(basisOfRecord == "LIVING_SPECIMEN") |> 
  atlas_counts()
```

```
## Warning: Invalid field(s) detected.
## ℹ See a listing of all valid fields with `show_all_fields()`.
## ℹ Search for the valid name of a desired field with `search_fields()`.
## ✖ Invalid field(s): basisOfRecord.
```

```
## # A tibble: 1 × 1
##   count
##   <int>
## 1     0
```

`search_profile_attributes` gives more information on criteria used
to remove records in data quality profiles, for example:


```r
search_profile_attributes("ALA") |> head()
```

```
## Warning: `search_profile_attributes()` was deprecated in galah 1.5.0.
## Please use `search_profiles('query') |> show_values()` instead.
```

```
## Error in `show_all_profiles()` at ]8;line=398:col=2;file://C:\Users\KEL329\OneDrive - CSIRO\Documents\ALA\Github\galah\R\search_all.Rgalah/R/search_all.R:398:2]8;;:
## ! The `profiles_all` API is not available for the selected atlas (United Kingdom)
## ℹ Use `show_all_apis()` to list valid API calls
```


# `show_all()` & search_all()

As of galah 1.5.0, there are two simplified functions to look up information: 
`show_all()` and `search_all()`. 

These are individual functions that are able to return all types of information 
in one place, rather than using specific sub-functions to look up information.

For example, to show all available Living Atlases supported:


```r
show_all(atlases)
```

```
## # A tibble: 11 × 4
##    atlas          institution                                                             acronym url                         
##    <chr>          <chr>                                                                   <chr>   <chr>                       
##  1 Australia      Atlas of Living Australia                                               ALA     https://www.ala.org.au      
##  2 Austria        Biodiversitäts-Atlas Österreich                                         BAO     https://biodiversityatlas.at
##  3 Brazil         Sistemas de Informações sobre a Biodiversidade Brasileira               SiBBr   https://sibbr.gov.br        
##  4 Canada         Candensys                                                               <NA>    http://www.canadensys.net   
##  5 Estonia        eElurikkus                                                              <NA>    https://elurikkus.ee        
##  6 France         Inventaire National du Patrimoine Naturel                               INPN    https://inpn.mnhn.fr        
##  7 Guatemala      Sistema Nacional de Información sobre Diversidad Biológica de Guatemala SNIBgt  https://snib.conap.gob.gt   
##  8 Portugal       GBIF Portugal                                                           GBIF.pt https://www.gbif.pt         
##  9 Spain          GBIF Spain                                                              GBIF.es https://www.gbif.es         
## 10 Sweden         Swedish Biodiversity Data Infrastructure                                SBDI    https://biodiversitydata.se 
## 11 United Kingdom National Biodiversity Network                                           NBN     https://nbn.org.uk
```

To search for a specific available Living Atlas:


```r
search_all(atlases, "Spain")
```

```
## # A tibble: 1 × 4
##   atlas institution acronym url                
##   <chr> <chr>       <chr>   <chr>              
## 1 Spain GBIF Spain  GBIF.es https://www.gbif.es
```

To show all fields:


```r
show_all(fields)
```

And to search for a specific field:


```r
search_all(fields, "australian states")
```

```
## # A tibble: 0 × 3
## # … with 3 variables: id <chr>, description <chr>, type <chr>
```



Here is a list of information types that can be used with `show_all()` and 
`search_all()`:

<table class="table lightable-paper" style='width: auto !important; margin-left: auto; margin-right: auto; font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
 <thead>
  <tr>
   <th style="text-align:left;"> Information type </th>
   <th style="text-align:left;"> Description </th>
   <th style="text-align:left;"> Sub-functions </th>
  </tr>
 </thead>
<tbody>
  <tr grouplength="3"><td colspan="3" style="background-color: #fdebf2; color: #343a40;"><strong>Configuration</strong></td></tr>
<tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> atlases </td>
   <td style="text-align:left;"> Show what living atlases are available </td>
   <td style="text-align:left;font-family: monospace;"> show_all_atlases(), search_atlases() </td>
  </tr>
  <tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> apis </td>
   <td style="text-align:left;"> Show what APIs &amp; functions are available for each atlas </td>
   <td style="text-align:left;font-family: monospace;"> show_all_apis(), search_apis() </td>
  </tr>
  <tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> reasons </td>
   <td style="text-align:left;"> Show what values are acceptable as 'download reasons' for a specified atlas </td>
   <td style="text-align:left;font-family: monospace;"> show_all_reasons(), search_reasons() </td>
  </tr>
  <tr grouplength="3"><td colspan="3" style="background-color: #fdebf2; color: #343a40;"><strong>Taxonomy</strong></td></tr>
<tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> taxa </td>
   <td style="text-align:left;"> Search for one or more taxonomic names </td>
   <td style="text-align:left;font-family: monospace;"> search_taxa() </td>
  </tr>
  <tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> identifiers </td>
   <td style="text-align:left;"> Take a universal identifier and return taxonomic information </td>
   <td style="text-align:left;font-family: monospace;"> search_identifiers() </td>
  </tr>
  <tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> ranks </td>
   <td style="text-align:left;"> Show valid taxonomic ranks (e.g. Kingdom, Class, Order, etc.) </td>
   <td style="text-align:left;font-family: monospace;"> show_all_ranks(), search_ranks()) </td>
  </tr>
  <tr grouplength="2"><td colspan="3" style="background-color: #fdebf2; color: #343a40;"><strong>Filters</strong></td></tr>
<tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> fields </td>
   <td style="text-align:left;"> Show fields that are stored in an atlas </td>
   <td style="text-align:left;font-family: monospace;"> show_all_fields(), search_fields() </td>
  </tr>
  <tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> assertions </td>
   <td style="text-align:left;"> Show results of data quality checks run by each atlas </td>
   <td style="text-align:left;font-family: monospace;"> show_all_assertions(), search_assertions() </td>
  </tr>
  <tr grouplength="2"><td colspan="3" style="background-color: #fdebf2; color: #343a40;"><strong>Group filters</strong></td></tr>
<tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> profiles </td>
   <td style="text-align:left;"> Show what data quality profiles are available </td>
   <td style="text-align:left;font-family: monospace;"> show_all_profiles(), search_profiles() </td>
  </tr>
  <tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> lists </td>
   <td style="text-align:left;"> Show what species lists are available </td>
   <td style="text-align:left;font-family: monospace;"> show_lists(), search_lists() </td>
  </tr>
  <tr grouplength="3"><td colspan="3" style="background-color: #fdebf2; color: #343a40;"><strong>Data providers</strong></td></tr>
<tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> providers </td>
   <td style="text-align:left;"> Show which institutions have provided data </td>
   <td style="text-align:left;font-family: monospace;"> show_all_providers(), search_providers() </td>
  </tr>
  <tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> collections </td>
   <td style="text-align:left;"> Show the specific collections within those institutions </td>
   <td style="text-align:left;font-family: monospace;"> show_all_collections(), search_collections() </td>
  </tr>
  <tr>
   <td style="text-align:left;font-family: monospace;padding-left: 2em;" indentlevel="1"> datasets </td>
   <td style="text-align:left;"> Shows all the data groupings within those collections </td>
   <td style="text-align:left;font-family: monospace;"> show_all_datasets(), search_datasets() </td>
  </tr>
</tbody>
</table>
