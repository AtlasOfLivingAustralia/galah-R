---
title: "Spatial filtering"
author: "Callum Waite & Shandiya Balasubramaniam"
date: '2023-10-13'
output:
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Spatial filtering}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



Biodiversity queries to the ALA usually require some spatial filtering. Let's 
see how spatial data are stored in the ALA and a few different methods to 
spatially filter data with galah and other packages.

Most records in the ALA contain location data in the form of two key fields: 
`decimalLatitude` and `decimalLongitude`. As expected, these fields are the 
decimal coordinates of each occurrence, with south and west values denoted by 
negatives. While there may be some uncertainty in these values (see field
`coordinateUncertaintyInMeters`), they are generally very accurate.

While these are very important and useful fields, very rarely will we encounter 
situations that require queries directly calling `decimalLatitude` and 
`decimalLongitude`. Instead, the ALA and galah have a number of features that 
make spatial queries simpler.

### Contextual and spatial layers

Often we want to filter results down to some commonly defined spatial regions, 
such as states, LGAs or IBRA/IMCRA regions. The ALA contains a large range 
(\>100) of contextual and spatial layers, in-built as searchable and queriable 
fields. They are denoted by names beginning with `"cl"`, followed by an 
identifying number that may be up to 6 digits long. These fields are each based 
on shapefiles, and contain the names of the regions in these layers that each 
record lies in.

We strongly recommend using `search_fields()` to check whether a contextual 
layer already exists in the ALA that matches what you require before proceeding 
with other methods of spatial filtering. These fields are all able to be queried 
with `filter()`and so they are generally easier to use.

Suppose we are interested in querying records of the Red-Necked Avocet 
([*Recurvirostra novaehollandiae*](https://bie.ala.org.au/species/https://biodiversity.org.au/afd/taxa/c69e7308-527a-429d-a80d-143bd20b5100)) 
in a particular protected wetlands, the Coorong wetlands in South Australia. We 
can search the ALA fields for wetlands.


```r
library(galah)
library(tidyverse)
library(gt)
library(sf)
```

```r
galah_config(email = "your_email_here", verbose = FALSE)
```

```r
search_fields("wetlands")
```

```
## # A tibble: 1 × 3
##   id    description                     type  
##   <chr> <chr>                           <chr> 
## 1 cl901 Directory of Important Wetlands fields
```

Our search identifies that layer `cl901` seems to match what we are looking for. 
We can then either view all possible values in the field with `show_values()`, 
or search again for our particular field.


```r
search_fields("cl901") |> search_values("coorong")
```

```
## • Showing values for 'cl901'.
```

```
## # A tibble: 1 × 1
##   cl901                                      
##   <chr>                                      
## 1 The Coorong, Lake Alexandrina & Lake Albert
```

We can filter all occurrences for exact matches with this value, `"Lake Eyre"`. 
Our `galah` query can be built as follows:


```r
galah_call() |>
  identify("Recurvirostra novaehollandiae") |>
  filter(cl901 == "The Coorong, Lake Alexandrina & Lake Albert") |>
  collect() |>
  head(5) |>
  gt::gt()
```

<!--html_preserve--><div id="jcszlxbqcj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#jcszlxbqcj table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#jcszlxbqcj thead, #jcszlxbqcj tbody, #jcszlxbqcj tfoot, #jcszlxbqcj tr, #jcszlxbqcj td, #jcszlxbqcj th {
  border-style: none;
}

#jcszlxbqcj p {
  margin: 0;
  padding: 0;
}

#jcszlxbqcj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jcszlxbqcj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#jcszlxbqcj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jcszlxbqcj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jcszlxbqcj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jcszlxbqcj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jcszlxbqcj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jcszlxbqcj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jcszlxbqcj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jcszlxbqcj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jcszlxbqcj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jcszlxbqcj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jcszlxbqcj .gt_spanner_row {
  border-bottom-style: hidden;
}

#jcszlxbqcj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#jcszlxbqcj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jcszlxbqcj .gt_from_md > :first-child {
  margin-top: 0;
}

#jcszlxbqcj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jcszlxbqcj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jcszlxbqcj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jcszlxbqcj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jcszlxbqcj .gt_row_group_first td {
  border-top-width: 2px;
}

#jcszlxbqcj .gt_row_group_first th {
  border-top-width: 2px;
}

#jcszlxbqcj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jcszlxbqcj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#jcszlxbqcj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jcszlxbqcj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jcszlxbqcj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jcszlxbqcj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jcszlxbqcj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#jcszlxbqcj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jcszlxbqcj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jcszlxbqcj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jcszlxbqcj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jcszlxbqcj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jcszlxbqcj .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jcszlxbqcj .gt_left {
  text-align: left;
}

#jcszlxbqcj .gt_center {
  text-align: center;
}

#jcszlxbqcj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jcszlxbqcj .gt_font_normal {
  font-weight: normal;
}

#jcszlxbqcj .gt_font_bold {
  font-weight: bold;
}

#jcszlxbqcj .gt_font_italic {
  font-style: italic;
}

#jcszlxbqcj .gt_super {
  font-size: 65%;
}

#jcszlxbqcj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#jcszlxbqcj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jcszlxbqcj .gt_indent_1 {
  text-indent: 5px;
}

#jcszlxbqcj .gt_indent_2 {
  text-indent: 10px;
}

#jcszlxbqcj .gt_indent_3 {
  text-indent: 15px;
}

#jcszlxbqcj .gt_indent_4 {
  text-indent: 20px;
}

#jcszlxbqcj .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="recordID">recordID</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="scientificName">scientificName</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="taxonConceptID">taxonConceptID</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="decimalLatitude">decimalLatitude</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="decimalLongitude">decimalLongitude</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="eventDate">eventDate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="occurrenceStatus">occurrenceStatus</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="dataResourceName">dataResourceName</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="recordID" class="gt_row gt_left">00630f58-ee78-4f69-ba39-718b0a1c3356</td>
<td headers="scientificName" class="gt_row gt_left">Recurvirostra novaehollandiae</td>
<td headers="taxonConceptID" class="gt_row gt_left">https://biodiversity.org.au/afd/taxa/c69e7308-527a-429d-a80d-143bd20b5100</td>
<td headers="decimalLatitude" class="gt_row gt_right">-35.59293</td>
<td headers="decimalLongitude" class="gt_row gt_right">139.0218</td>
<td headers="eventDate" class="gt_row gt_right">2008-11-18</td>
<td headers="occurrenceStatus" class="gt_row gt_left">PRESENT</td>
<td headers="dataResourceName" class="gt_row gt_left">SA Fauna</td></tr>
    <tr><td headers="recordID" class="gt_row gt_left">00705077-abc2-4f28-aedd-11a479ec2d82</td>
<td headers="scientificName" class="gt_row gt_left">Recurvirostra novaehollandiae</td>
<td headers="taxonConceptID" class="gt_row gt_left">https://biodiversity.org.au/afd/taxa/c69e7308-527a-429d-a80d-143bd20b5100</td>
<td headers="decimalLatitude" class="gt_row gt_right">-35.52833</td>
<td headers="decimalLongitude" class="gt_row gt_right">138.8089</td>
<td headers="eventDate" class="gt_row gt_right">2016-03-06</td>
<td headers="occurrenceStatus" class="gt_row gt_left">PRESENT</td>
<td headers="dataResourceName" class="gt_row gt_left">BirdLife Australia, Birdata</td></tr>
    <tr><td headers="recordID" class="gt_row gt_left">0071444e-ddf2-45dc-9a10-c6399686e306</td>
<td headers="scientificName" class="gt_row gt_left">Recurvirostra novaehollandiae</td>
<td headers="taxonConceptID" class="gt_row gt_left">https://biodiversity.org.au/afd/taxa/c69e7308-527a-429d-a80d-143bd20b5100</td>
<td headers="decimalLatitude" class="gt_row gt_right">-35.57719</td>
<td headers="decimalLongitude" class="gt_row gt_right">138.9923</td>
<td headers="eventDate" class="gt_row gt_right">2008-01-01</td>
<td headers="occurrenceStatus" class="gt_row gt_left">PRESENT</td>
<td headers="dataResourceName" class="gt_row gt_left">SA Fauna</td></tr>
    <tr><td headers="recordID" class="gt_row gt_left">008a2e6c-26b4-4f4e-a428-b0330db53466</td>
<td headers="scientificName" class="gt_row gt_left">Recurvirostra novaehollandiae</td>
<td headers="taxonConceptID" class="gt_row gt_left">https://biodiversity.org.au/afd/taxa/c69e7308-527a-429d-a80d-143bd20b5100</td>
<td headers="decimalLatitude" class="gt_row gt_right">-35.52831</td>
<td headers="decimalLongitude" class="gt_row gt_right">138.8280</td>
<td headers="eventDate" class="gt_row gt_right">2017-11-19 17:15:00</td>
<td headers="occurrenceStatus" class="gt_row gt_left">PRESENT</td>
<td headers="dataResourceName" class="gt_row gt_left">eBird Australia</td></tr>
    <tr><td headers="recordID" class="gt_row gt_left">00b11f13-0100-4471-b18b-7e9736ddeeaf</td>
<td headers="scientificName" class="gt_row gt_left">Recurvirostra novaehollandiae</td>
<td headers="taxonConceptID" class="gt_row gt_left">https://biodiversity.org.au/afd/taxa/c69e7308-527a-429d-a80d-143bd20b5100</td>
<td headers="decimalLatitude" class="gt_row gt_right">-36.18001</td>
<td headers="decimalLongitude" class="gt_row gt_right">139.6589</td>
<td headers="eventDate" class="gt_row gt_right">2017-08-05 13:25:00</td>
<td headers="occurrenceStatus" class="gt_row gt_left">PRESENT</td>
<td headers="dataResourceName" class="gt_row gt_left">eBird Australia</td></tr>
  </tbody>
  
  
</table>
</div><!--/html_preserve-->

### galah_geolocate()

While server-side spatial information is useful, there are likely to be cases 
where the shapefile or region you wish to query will not be pre-loaded as a 
contextual layer in the ALA. In this case, shapefiles can be introduced to the 
filtering process using the {sf} package and the `galah_geolocate()` function. 
Shapefiles can be provided as an `sf` object, whether that is by importing them 
with `sf::st_read()` or taking a `POLYGON` or `MULTIPOLYGON` character string and 
transforming them with `sf::st_as_sfc()`.

For instance, we might interested in species occurrences in King George Square, 
Brisbane. We can take the `MULTIPOLYGON` object for the square (as sourced from 
the [Brisbane City Council](https://www.data.brisbane.qld.gov.au/data/dataset/park-locations)) 
and transform it into `sfc` and then `sf` objects.


```r
king_george_sq <- "MULTIPOLYGON(((153.0243 -27.46886, 153.0242 -27.46896, 153.0236 -27.46837, 153.0239 -27.46814, 153.0239 -27.46813, 153.0242 -27.46789, 153.0244 -27.46805, 153.0245 -27.46821, 153.0246 -27.46828, 153.0247 -27.46835, 153.0248 -27.46848, 153.0246 -27.4686, 153.0246 -27.46862, 153.0245 -27.46871, 153.0243 -27.46886)))" |>
  sf::st_as_sfc() |> 
  sf::st_as_sf()
```

We can provide this `MULTIPOLYGON` in our filter as the argument of 
`galah_geolocate()` to assess which species have been recorded in King George 
Square.


```r
galah_call() |>
  galah_geolocate(king_george_sq) |>
  select(decimalLatitude, 
         decimalLongitude, 
         eventDate, 
         scientificName, 
         vernacularName) |>
  collect() |> 
  head(10) |>
  gt::gt()
```

<!--html_preserve--><div id="wkamkmknck" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wkamkmknck table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wkamkmknck thead, #wkamkmknck tbody, #wkamkmknck tfoot, #wkamkmknck tr, #wkamkmknck td, #wkamkmknck th {
  border-style: none;
}

#wkamkmknck p {
  margin: 0;
  padding: 0;
}

#wkamkmknck .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wkamkmknck .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wkamkmknck .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wkamkmknck .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wkamkmknck .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wkamkmknck .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wkamkmknck .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wkamkmknck .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wkamkmknck .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wkamkmknck .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wkamkmknck .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wkamkmknck .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wkamkmknck .gt_spanner_row {
  border-bottom-style: hidden;
}

#wkamkmknck .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wkamkmknck .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wkamkmknck .gt_from_md > :first-child {
  margin-top: 0;
}

#wkamkmknck .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wkamkmknck .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wkamkmknck .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wkamkmknck .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wkamkmknck .gt_row_group_first td {
  border-top-width: 2px;
}

#wkamkmknck .gt_row_group_first th {
  border-top-width: 2px;
}

#wkamkmknck .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wkamkmknck .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wkamkmknck .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wkamkmknck .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wkamkmknck .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wkamkmknck .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wkamkmknck .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wkamkmknck .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wkamkmknck .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wkamkmknck .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wkamkmknck .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wkamkmknck .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wkamkmknck .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wkamkmknck .gt_left {
  text-align: left;
}

#wkamkmknck .gt_center {
  text-align: center;
}

#wkamkmknck .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wkamkmknck .gt_font_normal {
  font-weight: normal;
}

#wkamkmknck .gt_font_bold {
  font-weight: bold;
}

#wkamkmknck .gt_font_italic {
  font-style: italic;
}

#wkamkmknck .gt_super {
  font-size: 65%;
}

#wkamkmknck .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wkamkmknck .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wkamkmknck .gt_indent_1 {
  text-indent: 5px;
}

#wkamkmknck .gt_indent_2 {
  text-indent: 10px;
}

#wkamkmknck .gt_indent_3 {
  text-indent: 15px;
}

#wkamkmknck .gt_indent_4 {
  text-indent: 20px;
}

#wkamkmknck .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="decimalLatitude">decimalLatitude</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="decimalLongitude">decimalLongitude</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="eventDate">eventDate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="scientificName">scientificName</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="vernacularName">vernacularName</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46862</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0243</td>
<td headers="eventDate" class="gt_row gt_right">2006-03-29 23:32:00</td>
<td headers="scientificName" class="gt_row gt_left">Threskiornis moluccus</td>
<td headers="vernacularName" class="gt_row gt_left">Australian White Ibis</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46861</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0244</td>
<td headers="eventDate" class="gt_row gt_right">2023-12-01 23:12:02</td>
<td headers="scientificName" class="gt_row gt_left">Cosmophasis baehrae</td>
<td headers="vernacularName" class="gt_row gt_left">NA</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46855</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0239</td>
<td headers="eventDate" class="gt_row gt_right">2024-02-03 10:45:00</td>
<td headers="scientificName" class="gt_row gt_left">Mediastinia</td>
<td headers="vernacularName" class="gt_row gt_left">NA</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46851</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0238</td>
<td headers="eventDate" class="gt_row gt_right">2023-04-08 07:49:00</td>
<td headers="scientificName" class="gt_row gt_left">Entomyzon cyanotis</td>
<td headers="vernacularName" class="gt_row gt_left">Blue-faced Honeyeater</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46842</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0241</td>
<td headers="eventDate" class="gt_row gt_right">2022-08-30 01:29:00</td>
<td headers="scientificName" class="gt_row gt_left">Threskiornis moluccus</td>
<td headers="vernacularName" class="gt_row gt_left">Australian White Ibis</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46833</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0241</td>
<td headers="eventDate" class="gt_row gt_right">2022-07-24 14:43:00</td>
<td headers="scientificName" class="gt_row gt_left">Threskiornis moluccus</td>
<td headers="vernacularName" class="gt_row gt_left">Australian White Ibis</td></tr>
  </tbody>
  
  
</table>
</div><!--/html_preserve-->

There is a second argument of `galah_geolocate()` called `type`, which defaults 
to value `"polygon"`. By setting the `type` argument to `"bbox"`, the provided 
`POLYGON` or `MULTIPOLYGON` will be converted into the smallest bounding box 
(rectangle) that contains the `POLYGON`. In this case, records will be included 
that may not exactly lie inside the provided shape.


```r
galah_call() |>
  galah_geolocate(king_george_sq, type = "bbox") |>
  select(decimalLatitude, 
         decimalLongitude, 
         eventDate, 
         scientificName, 
         vernacularName) |>
  collect() |>
  head(10) |>
  gt::gt()
```

```
## Data returned for bounding box:
## xmin = 153.0236 xmax = 153.0248 ymin = -27.46896 ymax = -27.46789
```

<!--html_preserve--><div id="isqsxhfmij" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#isqsxhfmij table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#isqsxhfmij thead, #isqsxhfmij tbody, #isqsxhfmij tfoot, #isqsxhfmij tr, #isqsxhfmij td, #isqsxhfmij th {
  border-style: none;
}

#isqsxhfmij p {
  margin: 0;
  padding: 0;
}

#isqsxhfmij .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#isqsxhfmij .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#isqsxhfmij .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#isqsxhfmij .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#isqsxhfmij .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#isqsxhfmij .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#isqsxhfmij .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#isqsxhfmij .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#isqsxhfmij .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#isqsxhfmij .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#isqsxhfmij .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#isqsxhfmij .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#isqsxhfmij .gt_spanner_row {
  border-bottom-style: hidden;
}

#isqsxhfmij .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#isqsxhfmij .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#isqsxhfmij .gt_from_md > :first-child {
  margin-top: 0;
}

#isqsxhfmij .gt_from_md > :last-child {
  margin-bottom: 0;
}

#isqsxhfmij .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#isqsxhfmij .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#isqsxhfmij .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#isqsxhfmij .gt_row_group_first td {
  border-top-width: 2px;
}

#isqsxhfmij .gt_row_group_first th {
  border-top-width: 2px;
}

#isqsxhfmij .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#isqsxhfmij .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#isqsxhfmij .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#isqsxhfmij .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#isqsxhfmij .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#isqsxhfmij .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#isqsxhfmij .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#isqsxhfmij .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#isqsxhfmij .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#isqsxhfmij .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#isqsxhfmij .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#isqsxhfmij .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#isqsxhfmij .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#isqsxhfmij .gt_left {
  text-align: left;
}

#isqsxhfmij .gt_center {
  text-align: center;
}

#isqsxhfmij .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#isqsxhfmij .gt_font_normal {
  font-weight: normal;
}

#isqsxhfmij .gt_font_bold {
  font-weight: bold;
}

#isqsxhfmij .gt_font_italic {
  font-style: italic;
}

#isqsxhfmij .gt_super {
  font-size: 65%;
}

#isqsxhfmij .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#isqsxhfmij .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#isqsxhfmij .gt_indent_1 {
  text-indent: 5px;
}

#isqsxhfmij .gt_indent_2 {
  text-indent: 10px;
}

#isqsxhfmij .gt_indent_3 {
  text-indent: 15px;
}

#isqsxhfmij .gt_indent_4 {
  text-indent: 20px;
}

#isqsxhfmij .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="decimalLatitude">decimalLatitude</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="decimalLongitude">decimalLongitude</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="eventDate">eventDate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="scientificName">scientificName</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="vernacularName">vernacularName</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46889</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0244</td>
<td headers="eventDate" class="gt_row gt_right">2015-10-09</td>
<td headers="scientificName" class="gt_row gt_left">Burhinus (Burhinus) grallarius</td>
<td headers="vernacularName" class="gt_row gt_left">Bush Stone-curlew</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46882</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0236</td>
<td headers="eventDate" class="gt_row gt_right">2019-04-21 04:40:00</td>
<td headers="scientificName" class="gt_row gt_left">Threskiornis moluccus</td>
<td headers="vernacularName" class="gt_row gt_left">Australian White Ibis</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46882</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0236</td>
<td headers="eventDate" class="gt_row gt_right">2005-08-28 12:18:00</td>
<td headers="scientificName" class="gt_row gt_left">Threskiornis moluccus</td>
<td headers="vernacularName" class="gt_row gt_left">Australian White Ibis</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46862</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0243</td>
<td headers="eventDate" class="gt_row gt_right">2006-03-29 23:32:00</td>
<td headers="scientificName" class="gt_row gt_left">Threskiornis moluccus</td>
<td headers="vernacularName" class="gt_row gt_left">Australian White Ibis</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46861</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0244</td>
<td headers="eventDate" class="gt_row gt_right">2023-12-01 23:12:02</td>
<td headers="scientificName" class="gt_row gt_left">Cosmophasis baehrae</td>
<td headers="vernacularName" class="gt_row gt_left">NA</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46855</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0239</td>
<td headers="eventDate" class="gt_row gt_right">2024-02-03 10:45:00</td>
<td headers="scientificName" class="gt_row gt_left">Mediastinia</td>
<td headers="vernacularName" class="gt_row gt_left">NA</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46851</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0238</td>
<td headers="eventDate" class="gt_row gt_right">2023-04-08 07:49:00</td>
<td headers="scientificName" class="gt_row gt_left">Entomyzon cyanotis</td>
<td headers="vernacularName" class="gt_row gt_left">Blue-faced Honeyeater</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46842</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0241</td>
<td headers="eventDate" class="gt_row gt_right">2022-08-30 01:29:00</td>
<td headers="scientificName" class="gt_row gt_left">Threskiornis moluccus</td>
<td headers="vernacularName" class="gt_row gt_left">Australian White Ibis</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46833</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0241</td>
<td headers="eventDate" class="gt_row gt_right">2022-07-24 14:43:00</td>
<td headers="scientificName" class="gt_row gt_left">Threskiornis moluccus</td>
<td headers="vernacularName" class="gt_row gt_left">Australian White Ibis</td></tr>
    <tr><td headers="decimalLatitude" class="gt_row gt_right">-27.46806</td>
<td headers="decimalLongitude" class="gt_row gt_right">153.0239</td>
<td headers="eventDate" class="gt_row gt_right">NA</td>
<td headers="scientificName" class="gt_row gt_left">Syntrichia laevipila</td>
<td headers="vernacularName" class="gt_row gt_left">Screw Moss</td></tr>
  </tbody>
  
  
</table>
</div><!--/html_preserve-->

#### Large shapefiles

The `type` argument with option `"bbox"` is provided because `sf` objects with 
\>500 vertices will not be accepted by the ALA. In the event you have a large 
shapefile, using `type = "bbox"` will at least enable an initial reduction of 
the data that is downloaded, before finer filtering to the actual shapefile will 
obtain the desired set of occurrences. Alternatively, one can also perform the 
`"bbox"` reduction before passing the shape to `galah_geolocate()` by using 
`sf::st_bbox()`.

A common situation for this to occur is when a shapefile with multiple shapes is 
provided, where we are interested in grouping our results by each shape. Here is 
a mock workflow using a subset of a shapefile of 
[all 2,184 Brisbane parks](https://www.data.brisbane.qld.gov.au/data/dataset/park-locations).

Let's say we are interested in knowing which parks in the Brisbane postcode 4075 
have the most occurrences of the Scaly-Breasted Lorikeet, 
[*Trichoglossus chlorolepidotus*](https://bie.ala.org.au//species/https://biodiversity.org.au/afd/taxa/ecaca7ec-da2e-4c6b-b190-14e7a1738884), 
since 2020. We can download the entire shapefile from the above link, and 
perform our filtering and summarising as follows:




```r
brisbane_parks <- sf::st_read("path/to/Park___Locations.shp") |>
  sf::st_make_valid() |>
  filter(POST_CODE == 4075)
```


```r
# Convert shapefile to a bounding box
brisbane_parks_bbox <- brisbane_parks |> sf::st_bbox()

# Find all occurrences of Trichoglossus chlorolepidotus in the bounding box in 2022
lorikeet_brisbane <- galah_call() |>
  filter(scientificName == "Trichoglossus chlorolepidotus", 
         year >= 2020) |>
  galah_geolocate(brisbane_parks_bbox, type = "bbox") |>
  collect()
```

```
## Data returned for bounding box:
## xmin = 152.96331 xmax = 152.99668 ymin = -27.57737 ymax = -27.51606
```


```r
# Filter records down to only those in the shapefile polygons
lorikeet_brisbane |>
  # Create a point geometry based on the occurrence coordinates
  sf::st_as_sf(coords = c("decimalLongitude", "decimalLatitude"), crs = sf::st_crs(brisbane_parks), remove = FALSE) |>
  # identify which park each occurrence sits in with st_intersects()
  mutate(intersection = sf::st_intersects(geometry, brisbane_parks) |> as.integer(),
         park = ifelse(is.na(intersection), NA, brisbane_parks$PARK_NAME[intersection])) |>
  # Filter out occurrences that did not occur in a park
  filter(!is.na(park)) |>
  # Drop the geometry column
  sf::st_drop_geometry() |>
  # Summarise the top 10 parks for lorikeet sightings in 2022
  group_by(park) |>
  summarise(counts = n()) |>
  arrange(desc(counts)) |>
  head(10)
```

```
## # A tibble: 10 × 2
##    park                           counts
##    <chr>                           <int>
##  1 SHERWOOD ARBORETUM                276
##  2 NYUNDARE-BA PARK                  271
##  3 FAULKNER PARK                      51
##  4 STRICKLAND TERRACE PARK            33
##  5 FORT ROAD BUSHLAND                 31
##  6 GRACEVILLE RIVERSIDE PARKLANDS     31
##  7 BENARRAWA RESERVE                  19
##  8 NOSWORTHY PARK                     16
##  9 HORACE WINDOW RESERVE               9
## 10 GRACEVILLE AVENUE PARK              6
```

Some shapefiles cover large geographic areas with the caveat that even the 
bounding box doesn't restrict the number of records to a value that can be 
downloaded easily. In this case, we recommend more nuances and detailed methods 
that can be performed using looping techniques. One of our ALA Labs blog posts, 
[Hex maps for species occurrence data](https://labs.ala.org.au/posts/2021-04-14_hex-maps-for-species-occurrence-data/), 
has been written detailing how to approach larger problems such as this.
